<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Taskify - To Do List</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <head>
      <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
        rel="stylesheet"
      />

      <style>
        body {
          font-family: "Poppins", sans-serif;
          color: #333;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
          font-weight: 700;
        }

        p,
        a,
        button,
        input,
        label {
          font-weight: 400;
        }
      </style>
    </head>
  </head>
  <body>
    <div class="container mt-4">
      <h1
        class="text-center mb-4"
        style="
          font-family: Arial, sans-serif;
          font-size: 80px;
          font-weight: bold;
        "
      >
        Taskify
      </h1>

      <div class="row text-center mb-4">
        <div class="col-md-4">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5>Total Tasks</h5>
              <p class="fs-4 fw-bold text-primary">{{ total_tasks }}</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5>Completed</h5>
              <p class="fs-4 fw-bold text-success">{{ completed_tasks }}</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5>Pending</h5>
              <p class="fs-4 fw-bold text-danger">{{ pending_tasks }}</p>
            </div>
          </div>
        </div>
      </div>

      <div class="mb-4">
        <label class="form-label fw-bold">Progress</label>
        <div class="progress">
          <div
            id="progress-bar"
            class="progress-bar"
            role="progressbar"
            style="width: {{ progress | default(0) }}%;"
            aria-valuenow="{{ progress | default(0) }}"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            {{ progress | default(0) }}%
          </div>
        </div>
        <p id="progress-message" class="mt-2 fw-semibold text-center"></p>
      </div>

      {% if progress == 100 and total_tasks > 0 %}
      <div
        class="alert alert-success text-center fw-bold mt-4"
        id="congrats-message"
      >
        Congratulations! All tasks are completed! Keep it up!
      </div>
      {% endif %}

      <!-- Task List -->
      <div class="d-flex justify-content-between mb-3">
        <h3>Your Tasks</h3>
        <a href="/add" class="btn btn-primary">Add Task</a>
      </div>

      <ul class="list-group">
        {% for task in tasks %}
        <li
          class="list-group-item d-flex justify-content-between align-items-center"
        >
          <div>
            <a
              href="/task/{{ task.id }}"
              class="fw-bold {% if task.status == 'Completed' %}text-decoration-line-through text-success{% endif %}"
            >
              {{ task.name }}
            </a>
            <small class="d-block text-muted">
              {{ task.due_date }} {{ task.due_time }}
            </small>
          </div>
          <div>
            <a
              href="/toggle_status/{{ task.id }}"
              class="btn btn-sm btn-outline-secondary"
            >
              {% if task.status == 'Pending' %}Complete{% else %}â†©Undo{% endif
              %}
            </a>
            <a href="/edit/{{ task.id }}" class="btn btn-sm btn-warning"
              >Edit</a
            >
            <a href="/delete/{{ task.id }}" class="btn btn-sm btn-danger"
              >Delete</a
            >
          </div>
        </li>
        {% else %}
        <li class="list-group-item text-center text-muted">
          No tasks yet. Add one!
        </li>
        {% endfor %}
      </ul>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const congrats = document.getElementById("congrats-message");
        if (congrats) {
          confetti({
            particleCount: 150,
            spread: 70,
            origin: { y: 0.6 },
          });
        }
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const progressBar = document.getElementById("progress-bar");
        const progressMsg = document.getElementById("progress-message");

        if (progressBar) {
          const value = parseInt(progressBar.getAttribute("aria-valuenow"));

          progressBar.classList.remove("red", "yellow", "green");

          if (value < 30) {
            progressBar.classList.add("red");
            progressMsg.textContent = "Just starting ";
          } else if (value < 70) {
            progressBar.classList.add("yellow");
            progressMsg.textContent = "Keep going";
          } else {
            progressBar.classList.add("green");
            progressMsg.textContent = "Almost there";
          }
        }
      });
    </script>
  </body>
</html>
